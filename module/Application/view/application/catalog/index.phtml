<?php
/**
 * @var Dashboard\Entity\File $file
 * @var Application\Entity\Vehicle $item
 * @var Application\Entity\Options\Taxonomy $option
 * @var Zend\View\Renderer\PhpRenderer $this
 */
foreach ($list as &$item) {
    $item['transparentImage'] = strval($this->basePath('/dashboard/img/trans.gif'));
    $item['link'] = $this->url('catalog', [
        'id' => $item['id'],
        'action' => 'card',
    ]);
}
?>
<script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.4.0/vue.js"></script>

<catalog inline-template>
<div class="container">
    <div class="row">
        <div class="col-lg-offset-1 col-md-offset-1 col-lg-11 col-md-11 breadcrumbs">
            <a href="<?= $this->url('catalog'); ?>" class="back">
                <span></span>
                <?= $this->translate('Назад');?>
            </a>
        </div>
        <div class="col-lg-offset-1 col-md-offset-1 col-lg-10 col-md-10 col-sm-12 col-xs-12 catalog">
            <h2><?= $this->translate('Купить');?></h2>
            <div class="row catalog-filter-group">
                <div class="col-lg-5 col-md-5 col-sm-12 col-xs-12 xs-margin-top">
                    <label><?=$this->translate('Марка');?></label>
                    <select name="model">
                        <?php foreach ($options['mods'] as $mark => $models) : ?>
                            <optgroup label="<?=$mark;?>">
                            <?php foreach ($models as $id => $model) : ?>
                                <option value="<?=$id?>"><?=$this->translate($model);?></option>
                            <?php endforeach; ?>
                            </optgroup>
                        <?php endforeach; ?>
                    </select>
                </div>
                <div class="catalog-clear-box-sm hidden-lg hidden-md hidden-xs"></div>
                <div class="col-lg-3 col-md-3 col-sm-4 col-xs-12 xs-margin-top">
                    <label for="yearFrom"><?=$this->translate('Год');?></label>
                    <div class="row">
                        <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6">
                            <select id="yearFrom" name="year[from]">
                            <?php foreach (range($options['years']['min'], $options['years']['max']) as $year) : ?>
                            <option value="<?=$year?>"><?=$year?></option>
                            <?php endforeach; ?>
                            </select>
                        </div>
                        <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6">
                            <select id="yearTo" name="year[to]">
                                <?php foreach (array_reverse(range($options['years']['min'], $options['years']['max'])) as $year) : ?>
                                <option value="<?=$year?>"><?=$year?></option>
                                <?php endforeach; ?>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="col-lg-2 col-md-2 col-sm-3 col-xs-6 xs-margin-top">
                    <label for="priceFrom"><?=$this->translate('Цена');?></label>
                    <select id="priceFrom" name="price[from]">
                        <?php foreach (range($options['prices']['min'], $options['prices']['max'], 1000) as $price) : ?>
                        <option value="<?=$price?>"><?=$price?></option>
                        <?php endforeach; ?>
                    </select>
                </div>
                <div class="col-lg-2 col-md-2 col-sm-3 col-xs-6 no-label">
                    <select id="priceTo" name="price[to]">
                        <?php foreach (array_reverse(range($options['prices']['min'], $options['prices']['max'], 1000)) as $price) : ?>
                        <option value="<?=$price?>"><?=$price?></option>
                        <?php endforeach; ?>
                    </select>
                </div>
            </div>

            <div v-show="allFilters" class="row catalog-filter-group hidden">
                <div class="col-lg-5 col-md-5 col-sm-12 col-xs-12 xs-margin-top">
                    <div class="row">
                        <div class="col-lg-4 col-md-4 col-sm-3 col-xs-12">
                            <label><?=$this->translate('Поколение');?></label>
                            <select>
                                <option value="1">One</option>
                            </select>
                        </div>
                        <div class="col-lg-4 col-md-4 col-sm-3 col-xs-12">
                            <label><?=$this->translate('Кузов');?></label>
                            <select>
                                <option value="1">One</option>
                            </select>
                        </div>
                        <div class="col-lg-4 col-md-4  col-sm-3 col-xs-12">
                            <label><?=$this->translate('Двигатель');?></label>
                            <select>
                                <option value="1">One</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="catalog-clear-box-sm hidden-lg hidden-md hidden-xs"></div>
                <div class="col-lg-3 col-md-3 col-sm-4 col-xs-12 xs-margin-top">
                    <label><?=$this->translate('Мощность');?></label>
                    <div class="row">
                        <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6">
                            <select>
                                <option value="1">One</option>
                            </select>
                        </div>
                        <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6">
                            <select>
                                <option value="1">One</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="col-lg-2 col-md-2 col-sm-3 col-xs-12 xs-margin-top">
                    <label><?=$this->translate('Коробка');?></label>
                    <select>
                        <option value="1">One</option>
                    </select>
                </div>
                <div class="col-lg-2 col-md-2 col-sm-3 col-xs-12 xs-margin-top">
                    <label><?=$this->translate('Привод');?></label>
                    <select>
                        <option value="1">One</option>
                    </select>
                </div>
            </div>
            <div class="row catalog-filter-group-checkboxes">
                <div v-show="allFilters" class="col-lg-5 col-md-5 col-sm-7 col-xs-12 xs-margin-top">
                    <div class="row">
                        <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4">
                            <input type="checkbox">
                            <label><?=$this->translate('Со скидкой');?></label>
                        </div>
                        <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4">
                            <input type="checkbox">
                            <label><?=$this->translate('Selected');?></label>
                        </div>
                        <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4">
                            <input type="checkbox">
                            <label><?=$this->translate('Новые');?></label>
                        </div>
                    </div>
                </div>
                <div class="col-lg-7 col-md-7 col-sm-5 col-xs-12 xs-margin-top">
                    <div class="row">
                        <div class="col-lg-7 col-md-7 col-sm-6 hidden-xs"></div>
                        <div class="hidden-lg hidden-md hidden-sm col-xs-6">
                            <a class="catalog-hide-filters {{allFilters ? '' : 'collapsed'}}"
                               href="javascript:"
                               @click="allFilters=!allFilters"
                            >
                                {{allFilters ? 'Скрыть фильтры' : 'Все фильтры'}}
                            </a>
                        </div>
                        <div class="col-lg-5 col-md-5 col-sm-6 col-xs-6">
                            <a class="catalog-drop-filters" href="javascript:">
                                <?=$this->translate("Сбросить фильтры");?>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="grey-light-block offers-grid-block">
    <div class="container">
        <div class="row">
            <div class="col-lg-5 col-lg-offset-1 col-md-5 col-sm-8 col-xs-12 col-md-offset-1 catalog-offers-grid-block-title">
                <?= $this->translate('Каталог легковых автомобилей');?>
                <p>127 автомобилей</p>
            </div>
            <div class="col-lg-5 col-md-5 col-sm-4 col-xs-12 catalog-offers-grid-block-filter">
                <div class="row">
                    <div class="col-lg-6 col-md-6 col-sm-2 hidden-xs">
                    </div>
                    <div class="col-lg-6 col-md-6 col-sm-10 col-xs-12">
                        <select data-dropdown-options='{"customClass":"gray-dropdown"}'>
                            <option value="1">One</option>
                            <option value="1">One</option>
                            <option value="1">One</option>
                            <option value="1">One</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="col-lg-10 col-lg-offset-1 col-md-10 col-sm-12 col-xs-12 col-md-offset-1">
                <div class="row" id="cards-list">
                    <card-item
                            v-for="item in cardsList"
                            v-bind:card="item"
                            v-bind:key="item.id">
                    </card-item>
                </div>
                <pagination
                        v-if="totalCards > 12"
                        :current="currentPage"
                        :total="totalCards"
                        :perPage="perPage"
                        @page-changed="fetchCards"
                ></pagination>
            </div>
        </div>
    </div>
</div>
</catalog>

<script type="text/javascript">

    Vue.component('card-item', {
        props: ['card'],
        template:   '\
            <div class="col-lg-4 col-md-4 col-sm-4 col-xs-6 offers-grid-block-tile">\
                <a :href="card.link" class="offers-grid-block-grid-bg">\
                    <img style="background-position: center; background-size: cover; height: 250px; width: 100%;" \
                        :style="{ backgroundImage: `url(` + card.preview + `)` }" \
                        :src="card.transparentImage" :alt="card.taxonomy"/>\
                </a>\
                <div :href="card.link" class="offers-grid-block-grid-name">\
                    <a :href="card.link">{{ card.taxonomy }}</a><br>\
                    <span class="price" v-html="card.price"></span>\
                </div>\
                <div class="offers-grid-block-grid-desc">\
                    {{ card.year }}, {{ card.volume }}, {{ card.transmission.name }}, \
                    {{ card.fuel.name }}, {{ card.body.name }}, {{ card.drive.name }}\
                </div>\
            </div>\
        '
    });

    var cardList = <?=json_encode($list);?>;
    var cards = new Vue({
        el: '#cards-list',
        data: {
            cardsList: cardList
        }
    });
</script>